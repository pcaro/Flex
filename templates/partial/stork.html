{% if 'pelican.plugins.search' in PLUGINS %}
  {% if STORK_VERSION %}
  <script src="https://files.stork-search.net/releases/v{{ STORK_VERSION }}/stork.js"></script>
  {% else %}
  <script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/stork/stork.js"></script>
  {% endif %}
  <script>
    window.storkIndexLoaded = false;
    window.loadStorkIndex = function () {
      if (window.storkIndexLoaded) {
        return;
      }
      if (typeof stork === 'undefined') {
        console.error('Stork is not loaded yet, retrying...');
        setTimeout(window.loadStorkIndex, 100);
        return;
      }
      {% if not STORK_VERSION %}
      stork.initialize("{{ SITEURL }}/{{ THEME_STATIC_DIR }}/stork/stork.wasm")
      {% endif %}
      stork.register("sitesearch", "{{ SITEURL }}/search-index.st", { showProgress: false });
      stork.register("sitesearch-page", "{{ SITEURL }}/search-index.st", { showProgress: false });
      window.storkIndexLoaded = true;
    }
  </script>
{% endif %}
